{"version":1,"defaultTimeframe":{"from":"now-2h","to":"now"},"sections":[{"id":"0","type":"markdown","markdown":"\nThis lab utilizes a GitHub Codespaces instance to run a Kubernetes cluster with an Internal Development Platform (IDP).\n\n![IDP Architecture](https://university.dynatrace.com/assets/50457/01_00_idp_architecture.png)\n\n* Dynatrace Tenant Setup\n* GitHub Repository & Codespaces Setup\n* IDP Setup & Validation"},{"id":"1","type":"markdown","markdown":"\nYou will need a Dynatrace SaaS tenant.\n\n### Identify Dynatrace SaaS Tenant\n\nMake a note of the Dynatrace environment name. This is the first part of the URL. `abc12345` would be the environment ID for `https://abc12345.apps.dynatrace.com`\n\n* For those running in other environments (such as `sprint`), make a note of your environment: `dev`, `sprint` or `live`\n\n### Skip DT OAuth Client (optional)\n\n> ⚠️ Stop! If you are unable to create an OAuth Client, you can still complete this lab with partial functionality ⚠️\n\nUse the following fake values for your OAuth Client:\n\nClient id: \n```text\ndt0f02.ABC123\n```\n\nClient secret:\n```text\ndt0f02.ABC123.J5TVHCR6MJ4AAO4PX3MFGUKX4E42QJ4MUAM65DGC7ZKOHBK7DKY23WQPBKO\n```\n\nAccount URN:\n```text\nurn:dtaccount:e64e7279-f0b0-43e0-aedb-9eb3fa8c5cac\n```\n\n### Create DT OAuth Client\n\nOpen the Dynatrace Account Management page.  Click on `Identity & access management`.  Click on `OAuth clients`.\n\n![OAuth Clients](https://university.dynatrace.com/assets/50457/01_01_oauth_clients.png)\n\nCreate a new OAuth Client by clicking on `Create client`.\n\nProvide your account email address and name the client `segments-client`.\n\nConfigure the client to have the following permissions:\n\n> - `document:documents:write`\n> - `document:documents:read`\n> - `automation:workflows:read`\n> - `automation:workflows:write`\n> - `storage:logs:read`\n> - `storage:events:read`\n> - `storage:events:write`\n> - `storage:metrics:read`\n> - `storage:bizevents:read`\n> - `storage:bizevents:write`\n> - `storage:system:read`\n> - `storage:buckets:read`\n> - `storage:spans:read`\n> - `storage:entities:read`\n> - `storage:fieldsets:read`\n\nNote: Your user account must have these permissions.  Follow [the documentation](https://www.dynatrace.com/support/help/platform-modules/business-analytics/ba-api-ingest) to set up an OAuth client + policy + bind to your service user account email.\n\n![OAuth Client Details](https://university.dynatrace.com/assets/50457/01_01_new_oauth_client_details.png)\n\nAfter the client is created, copy and save the client details.  Once you click `Finish`, you can never obtain the `client secret` ever again!!\n\nYou should now have 5 pieces of information:\n\n1. A DT environment (`dev`, `sprint` or `live`)\n1. A DT environment ID\n1. An OAuth client ID\n1. An OAuth client secret\n1. An account URN\n\n### Create DT API Token\n\nCreate a Dynatrace access token with the following permissions. This token will be used by the setup script to automatically create all other required DT tokens.\n\n1. `apiTokens.read`\n1. `apiTokens.write`\n\n![Dynatrace API Token](https://university.dynatrace.com/assets/50457/01_01_dynatrace_api_token.png)\n\nYou should now have 6 pieces of information:\n\n1. A DT environment (`dev`, `sprint` or `live`)\n1. A DT environment ID\n1. An oAuth client ID\n1. An oAuth client secret\n1. An account URN\n1. An API token"},{"id":"2","type":"markdown","markdown":"\nYou will need a GitHub account.\n\nThe source repository for this lab is: \n\n[enablement-openpipeline-segments-iam](https://github.com/dynatrace-wwse/enablement-openpipeline-segments-iam)\n\nThe reference repository (*not* used for this lab) is:\n\n[platform-engineering-demo](https://github.com/dynatrace-perfclinics/platform-engineering-demo)\n\n### Fork Repository\n\nCreate your own fork of the source repository.\n\n> ⚠️ Note ⚠️ running this lab will modify the repository, you will need to delete your fork and start from the beginning (new fork) every time you run this lab!\n\n![Create Fork](https://university.dynatrace.com/assets/50457/01_02_github_create_fork.png)\n\n### ⚠️ Enable Actions in your Fork ⚠️\n\n> ⚠️ This step is important! ⚠️\n\nThis lab uses one GitHub action to automatically merge Pull Requests when apps are onboarded.\n\nIn your fork, go to `Actions` and click the green button: `I understand my workflows, go ahead and enable them`.\n\n![GitHub Actions](https://university.dynatrace.com/assets/50457/01_02_github_enable_actions.png)\n\n### Delete ArgoCD Hook Jobs (optional)\n\nIf you do not have an OAuth Client, you will not be able to execute ArgoCD Hook Jobs that generate BizEvent data.\n\n![ArgoCD Hook Jobs](https://university.dynatrace.com/assets/50457/01_02_argohookjobs.png)\n\nIn your fork, go to `Code`.  Navigate to `/apptemplates/simplenodeservice-content/argohookjobs.yml`.\n\nEdit the file, delete all contents, and replace with `---`.  Save the file.\n\n### Configure Codespaces Settings\n\nBy default, codespaces instances will suspend after 30 minutes of inactivity.  This may cause problems with your lab.\n\nOpen GitHub Account settings at [https://github.com/settings/profile](https://github.com/settings/profile)\n\n![Codespaces Settings](https://university.dynatrace.com/assets/50457/01_02_codespaces_settings.png)\n\nIncrease the `Default idle timeout` setting.\n\n### Create Codespaces Instance\n\nIn your fork:\n\n1. Switch to the `main` branch\n1. Click the green `Code` button\n1. Change to `Codespaces`\n1. Click the `...` and choose `New with options...`\n\n![New Codespaces Instance](https://university.dynatrace.com/assets/50457/01_02_codespaces_new_with_options.png)\n\n**Warning!** Do not click the green \"Create codespace on codespace\" button!!\n\nFill in the form and launch the codespace.\n\n![Codespaces Configuration](https://university.dynatrace.com/assets/50457/01_02_codespaces_machine_type.png)\n\nBe sure to select 4-core as your machine type.\n\nChoose a region close to your Dynatrace tenant.  If you run into issues with spinning up your codespaces instance, try selecting a different region.\n\n![Codespaces Secrets](https://university.dynatrace.com/assets/50457/01_02_codespaces_new_secrets.png)\n\nIf you have **already** defined the environment variables in your repository, you'll see a screen asking you to associate those secrets with this repository. Please check the boxes as shown below.\n\n![Codespaces Existing Secrets](https://university.dynatrace.com/assets/50457/01_02_codespaces_existing_secrets.png)\n\nThe codespaces instance will launch and the setup scripts will execute.\n\nWait until the `Running postStartCommand...` disappears. It should take ~10 minutes.\n\n### Activate Kubernetes Experience in Dynatrace\n\nWhen the codespaces instance is finished launching, go to the Terminal prompt and run the following command:\n\n```text\nkubectl get pods -n dynatrace\n```\n\n![Dynatrace ActiveGate Pod](https://university.dynatrace.com/assets/50457/01_02_dynatrace_activegate_pod.png)\n\nRun this command every couple minutes until you see the `platform-engineering-demo-activegate-0` pod running and ready.\n\nNavigate to the Dynatrace tenant and launch the `Kubernetes` App.  You should eventually see a cluster pending activation.  Activate the Kubernetes Experience for your `platform-engineering-demo` cluster.\n\n![Dynatrace Kubernetes Experience Activation](https://university.dynatrace.com/assets/50457/01_02_kubernetes_experience.png)\n"},{"id":"3","type":"markdown","markdown":"\nWhen the codespaces instance is fully initialized and running, you'll be able to access the IDP components.\n\n### Login to ArgoCD\n\nGet ArgoCD password:\n\n```\nARGOCDPWD=$(kubectl -n argocd get secret argocd-initial-admin-secret -o jsonpath=\"{.data.password}\" | base64 -d)\necho $ARGOCDPWD\n```\n\nThe username is: `admin`\n\nChange to `Ports` tab and open ArgoCD (port `30100`) & log in as `admin`.\n\n![ArgoCD Login](https://university.dynatrace.com/assets/50457/01_03_argocd.png)\n\n![ArgoCD Overview](https://university.dynatrace.com/assets/50457/01_03_argocd_overview.png)\n\n### Login to Backstage\n\nBackstage is available (port `30105`) without any login credentials.\n\nChange to `Ports` tab and open Backstage (port `30105`).\n\n![Backstage Login](https://university.dynatrace.com/assets/50457/01_03_backstage.png)"}]}