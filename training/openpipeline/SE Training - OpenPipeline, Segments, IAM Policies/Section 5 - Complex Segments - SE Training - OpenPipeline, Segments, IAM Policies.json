{"version":1,"defaultTimeframe":{"from":"now-2h","to":"now"},"sections":[{"id":"0","type":"markdown","markdown":"\nConfigure and use Segments to apply filters to data retrieved from Grail.\n\n* Configure (more) complex Segments\n    - Project Team (Ownership, IDP)\n* Analyze with Segments"},{"id":"1","type":"markdown","markdown":"\nCreate Segment to filter analysis on IDP Project Team\n\n### Create Segment\n\nIn the Dynatrace environment, locate and launch the `Segments` App.\n\n![Segments App](https://university.dynatrace.com/assets/50457/05_01_segments_add_segment.png)\n\nClick on `+ Segment` to create a new Segment.\n\n![idp-proj-team Segment](https://university.dynatrace.com/assets/50457/05_01_project_team_segment.png)\n\nName the Segment `idp-proj-team`.\n\nBegin by defining a Variable for the Segment.\n\n![idp-proj-team Variable](https://university.dynatrace.com/assets/50457/05_01_project_team_variable.png)\n\nIn your Variables configuration, enter the following DQL Query:\n\n```sql\nfetch dt.entity.service\n| fields id, entity.name, tags\n| expand tags\n| filter matchesPhrase(tags,\"[Kubernetes]dt.owner\")\n| parse tags, \"DATA:tag_key ':' DATA:tag_value\"\n| summarize count(), by: {tag_value, tags}\n| fields `proj_team` = tag_value, tags\n```\n\nClick `Preview` to run the query.  You should see your `team01` and `team02` dt.owner details.\n\nClick `Done`.\n\n![idp-proj-team Segment](https://university.dynatrace.com/assets/50457/05_01_project_team_segment.png)\n\nUnder Segment data, create a new rule for `All data types`.  Type to add a filter.  Use the following filter:\n\n```text\nidp_team = \"$proj_team\"\n```\n\nAdding this segment data filter to our Segment will apply to any Grail data queries when this Segment is applied.\n\nUnder Segment data, create a new rule for `Entities` > `Service`.  Type to add a filter.  Use the following filter:\n\n```text\ntags = \"$tags\"\n```\n\nAdd related entities to the Segment data filter.  Click on `+ Related entity` and choose `Process`.  This will include any Process entity that is related to the Service.  Type to add a filter.  Use the following filter:\n\n```text\ntags = \"$tags\"\n```\n\nNext, click on `+ Related entity` and choose `Process Group`.  Type to add a filter.  Use the following filter:\n\n```text\ntags = \"$tags\"\n```\n\nRepeat this process for ALL remaining related entity types, not using a filter.\n\nAs you make your configurations, clicking on `Preview` will allow you to see which entities or data types matched your filter.\n\nWhen your Segment configuration is complete, click on `Save`.\n\nNote: You can change the visibility of your Segment, however if you are the only one accessing the environment, this is irrelevant."},{"id":"2","type":"markdown","markdown":"\nAnalyze the applications in Dynatrace, this time using the newly created Segments.\n\n### Explore IDP SimpleNodeServices Dashboard\n\nIf you haven't already, import the [IDP SimpleNodeServices](https://github.com/dynatrace-wwse/enablement-openpipeline-segments-iam/blob/main/lab-guide/assets/dynatrace/IDP_%20SimpleNodeServices_Dashboard.json) Dashboard into the Dynatrace environment.\n\n![IDP SimpleNodeServices Dashboard](https://university.dynatrace.com/assets/50457/05_02_dashboard_previous_segments.png)\n\nIf the previous Segment filters were removed, re-apply the cluster and namespace Segment filters.\n\nApply the new Segment filter to the dashboard.  Click on the `Segments` icon to open the Segments filter prompt (next to the timeframe selector).\n\n![Dashboard New Segment](https://university.dynatrace.com/assets/50457/05_02_dashboard_apply_segments.png)\n\nClick on `+ Segment` to add a new Segment filter.  Select the `idp-proj-team` Segment.  Click the checkbox to apply `team01` for the dynamic Segment.\n\nClick `Apply` to update the Segment filter.\n\nUse the variable selector for `Namespace`.  Notice the reduced list of namespaces available to choose from.\n\n### Explore Services App\n\nLaunch the `Services` App.  Identify the services that have been detected in the environment.\n\n![Services No Segments](https://university.dynatrace.com/assets/50457/05_02_services_no_segments.png)\n\nLocate and click on the `Segments` icon to open the Segments filter prompt (top left corner of the App).\n\n![Services Apply Segments](https://university.dynatrace.com/assets/50457/05_02_services_apply_segments.png)\n\nClick on `+ Segment` to add a new Segment filter.  Select the `idp-proj-team` Segment.  Click the checkbox to apply `team01` and `team02` for the dynamic Segment.\n\nClick `Apply` to update the Segment filter.\n\nNotice the reduced list of services available to choose from.\n"}]}