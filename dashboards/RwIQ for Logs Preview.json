{"version":18,"variables":[{"key":"Bucketd","visible":true,"type":"query","version":1,"editable":true,"input":"fetch dt.system.buckets\n| filter dt.system.table == \"logs\"","multiple":false,"defaultValue":"default_logs"},{"key":"SimulateIncludedQueriesDays","visible":true,"type":"text","version":1,"editable":true,"defaultValue":"10"},{"key":"PriceQuery","visible":true,"type":"text","version":1,"editable":true,"defaultValue":"0.0035"},{"key":"PriceRetain","visible":true,"type":"text","version":1,"editable":true,"defaultValue":"0.0007"},{"key":"PriceRwIQ","visible":true,"type":"text","version":1,"editable":true,"defaultValue":"0.02"},{"key":"Refresh","visible":true,"type":"text","version":1,"editable":true,"defaultValue":"Click here to refresh"}],"tiles":{"0":{"type":"markdown","content":"This dashboard can help to decide if the Hybrid-Retain with Included queries is a good option for a bucket.\n\nâš ï¸ Caution: Provide values are estimates based on current usage. Once new model is adopted the real values may be different."},"3":{"title":"Buckets","type":"data","query":"fetch dt.system.query_executions, from: now()-28d\n| filter startsWith(query_string, \"fetch logs\")\n| summarize scanned_volume = sum(scanned_bytes), by: {bucket}\n| filterOut scanned_volume == 0 or isNull(bucket) or bucket == \"\"\n| sort scanned_volume desc\n| join [\n  fetch dt.system.buckets\n  | filter dt.system.table == \"logs\"\n  | fieldsAdd query_quota = if (included_query_days > 0, (estimated_uncompressed_bytes / retention_days) * included_query_days * 15.0, else: 0) \n  | fields bucket = name, included_query_days, retention_days, \n  size_included = (estimated_uncompressed_bytes / retention_days) * included_query_days,\n  size = estimated_uncompressed_bytes, query_quota\n  | sort size desc\n], on: bucket\n// estimation is assuming linear growth of data, works well with buckets with established ingest pattern.\n| fieldsAdd est_daily_ingest = right.size / right.retention_days\n// average daily scanned volume / est daily ingest \n| fieldsAdd query_to_size_ratio = (scanned_volume / 28) / est_daily_ingest\n// scanned volume in 28d divided by bucket size\n| fieldsAdd query_to_size_ratio_v2 = (scanned_volume) / (right.size)\n// ratio of potential quota usage\n| fieldsAdd query_to_size_ratio_v3 = (scanned_volume / 28) / (15.0 * toLong($SimulateIncludedQueriesDays) * est_daily_ingest)\n| fieldsAdd rwiq = if (query_to_size_ratio >= 300, \"ðŸŸ¢\", else: if (query_to_size_ratio_v2 >= 60, \"ðŸŸ¡\", else: \"ðŸ”´\"))\n// | fieldsAdd rwiq = if (query_to_size_ratio_v3 <= 0.1, \"ðŸ”´\", else: if (query_to_size_ratio_v3 >= 2.5, \"ðŸ”´\", else: \"ðŸŸ¢\")) \n| fieldsAdd rwiq = if (right.retention_days >= 90, \"ðŸ”µ\", else: rwiq)\n| fields rwiq, bucket, retention_days = right.retention_days, size = right.size, scanned_volume, est_daily_ingest \n// query_to_size_ratio_v3, query_to_size_ratio, query_to_size_ratio_v2, \n| sort rwiq desc","visualization":"table","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"gap","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"curve":"linear","pointsDisplay":"auto","categoricalBarChartSettings":{"layout":"horizontal","categoryAxisTickLayout":"horizontal","scale":"absolute","groupMode":"stacked","colorPaletteMode":"multi-color","valueAxisScale":"linear"},"colorPalette":"categorical","valueRepresentation":"absolute","truncationMode":"middle"},"singleValue":{"showLabel":true,"label":"","prefixIcon":"AnalyticsIcon","isIconVisible":false,"autoscale":true,"alignment":"center","colorThresholdTarget":"value"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"linewrapEnabled":false,"lineWrapIds":[],"monospacedFontEnabled":false,"monospacedFontColumns":[],"columnWidths":{"[\"bucket\"]":491.29998779296886,"[\"size\"]":129.1666717529297},"columnTypeOverrides":[],"columnOrder":["[\"rwiq\"]","[\"bucket\"]","[\"retention_days\"]","[\"size\"]","[\"scanned_volume\"]","[\"est_daily_ingest\"]"],"sortBy":[]},"honeycomb":{"shape":"hexagon","legend":{"hidden":false,"position":"auto","ratio":"auto"},"dataMappings":{},"displayedFields":[],"truncationMode":"middle","colorMode":"color-palette","colorPalette":"categorical"},"histogram":{"legend":{"position":"auto"},"yAxis":{"label":"Frequency","isLabelVisible":true,"scale":"linear"},"colorPalette":"categorical","dataMappings":[],"variant":"single","truncationMode":"middle"},"valueBoundaries":{"min":"auto","max":"auto"},"autoSelectVisualization":false,"unitsOverrides":[{"identifier":"scanned_volume","unitCategory":"data","baseUnit":"byte","displayUnit":null,"decimals":1,"suffix":"","delimiter":false,"added":1742988494767},{"identifier":"retention_days","unitCategory":"time","baseUnit":"day","displayUnit":"day","decimals":0,"suffix":"","delimiter":false,"added":1742988506925},{"identifier":"size","unitCategory":"data","baseUnit":"byte","displayUnit":null,"decimals":1,"suffix":"","delimiter":false,"added":1742988528491},{"identifier":"est_daily_ingest","unitCategory":"data","baseUnit":"byte","displayUnit":null,"decimals":1,"suffix":"","delimiter":false,"added":1746709107870}]},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false},"davis":{"enabled":false,"davisVisualization":{"isAvailable":true}}},"9":{"title":"Query distribution by timeframe","type":"data","query":"fetch dt.system.query_executions, from: now()-35d\n| filter startsWith(query_string, \"fetch logs\")\n| filterOut status == \"FAILED\"\n| filter bucket == $Bucketd\n| fieldsAdd \ndiff = unixSecondsFromTimestamp(timestamp) - unixSecondsFromTimestamp(analysis_timeframe.start) \n| fields days = diff / 3600 / 24\n| fieldsAdd days = if (days > 35, 36, else: days)\n| filterOut days < 0\n| fieldsAdd category = if (days > 35, \"35d+\", else: (if (days < 10, \"below 10d\", else: \"10d-35d\")))\n| summarize count(), by: {category}\n| sort category asc\n\n\n// | fields  timestamp, start, diff, days\n","visualization":"donutChart","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"gap","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"curve":"linear","pointsDisplay":"auto","categoricalBarChartSettings":{"layout":"vertical","categoryAxisTickLayout":"horizontal","scale":"absolute","groupMode":"grouped","colorPaletteMode":"multi-color","valueAxisScale":"linear","categoryAxis":["category"],"valueAxis":["count()"],"categoryAxisLabel":"category","valueAxisLabel":"count()","tooltipVariant":"single","isCategoryLabelVisible":true,"isValueLabelVisible":false},"colorPalette":"categorical","valueRepresentation":"absolute","truncationMode":"middle","xAxisScaling":"auto","xAxisLabel":"timestamp","xAxisIsLabelVisible":false,"hiddenLegendFields":["VERSION","delivered_records","execution_duration_ms","query_end","query_queue_time_ms","query_start","sampling_ratio","scanned_bytes","scanned_bytes.included","scanned_bytes.on_demand","scanned_data_points","scanned_records","failed_count"],"leftYAxisSettings":{},"legend":{"position":"bottom","hidden":false}},"singleValue":{"showLabel":true,"label":"","prefixIcon":"AnalyticsIcon","isIconVisible":false,"autoscale":true,"alignment":"center","colorThresholdTarget":"value"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"linewrapEnabled":false,"lineWrapIds":[],"monospacedFontEnabled":false,"monospacedFontColumns":[],"columnWidths":{},"columnTypeOverrides":[],"columnOrder":["[\"category\"]","[\"count()\"]"]},"honeycomb":{"shape":"hexagon","legend":{"hidden":false,"position":"auto","ratio":"auto"},"dataMappings":{},"displayedFields":[],"truncationMode":"middle","colorMode":"color-palette","colorPalette":"categorical"},"histogram":{"legend":{"position":"auto"},"yAxis":{"label":"Frequency","isLabelVisible":true,"scale":"linear"},"colorPalette":"categorical","dataMappings":[],"variant":"single","truncationMode":"middle"},"valueBoundaries":{"min":"auto","max":"auto"},"autoSelectVisualization":false},"querySettings":{"maxResultRecords":10000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":10,"defaultSamplingRatio":10,"enableSampling":false},"davis":{"enabled":false,"davisVisualization":{"isAvailable":true}}},"10":{"type":"markdown","content":"The Data below will show you usage and scanned volumes of data stored in **$Bucketd** bucket.\n\nOnce you configure bucket to use RwIQ you will see the daily usage of query quota by looking at included series on the chart\n\n"},"12":{"title":"Est. 24h query quota for \"Retain with Included Queries\" data","type":"data","query":"fetch dt.system.buckets\n| filter dt.system.table == \"logs\"\n| filter name == $Bucketd\n| fieldsAdd included_query_days = if (toLong($SimulateIncludedQueriesDays) >= 0, toLong($SimulateIncludedQueriesDays), else: included_query_days)\n| fieldsAdd query_quota = if (included_query_days > 0, (estimated_uncompressed_bytes / retention_days) * included_query_days * 15.0, else: 0) \n| fields query_quota\n","visualization":"singleValue","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"gap","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"curve":"linear","pointsDisplay":"auto","categoricalBarChartSettings":{"layout":"horizontal","categoryAxisTickLayout":"horizontal","scale":"absolute","groupMode":"stacked","colorPaletteMode":"multi-color","valueAxisScale":"linear"},"colorPalette":"categorical","valueRepresentation":"absolute","truncationMode":"middle","xAxisScaling":"analyzedTimeframe","xAxisLabel":"timeframe","xAxisIsLabelVisible":false,"hiddenLegendFields":["interval"],"leftYAxisSettings":{}},"singleValue":{"showLabel":false,"label":"query_quota","prefixIcon":"AnalyticsIcon","isIconVisible":false,"autoscale":true,"alignment":"center","colorThresholdTarget":"value","recordField":"query_quota","trend":{"trendType":"auto","isVisible":true},"sparklineSettings":{}},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"linewrapEnabled":false,"lineWrapIds":[],"monospacedFontEnabled":false,"monospacedFontColumns":[],"columnWidths":{},"columnTypeOverrides":[]},"honeycomb":{"shape":"hexagon","legend":{"hidden":false,"position":"auto","ratio":"auto"},"dataMappings":{},"displayedFields":[],"truncationMode":"middle","colorMode":"color-palette","colorPalette":"categorical"},"histogram":{"legend":{"position":"auto"},"yAxis":{"label":"Frequency","isLabelVisible":true,"scale":"linear"},"colorPalette":"categorical","dataMappings":[],"variant":"single","truncationMode":"middle"},"valueBoundaries":{"min":"auto","max":"auto"},"autoSelectVisualization":false,"unitsOverrides":[{"identifier":"query_quota","unitCategory":"data","baseUnit":"byte","displayUnit":null,"decimals":2,"suffix":"","delimiter":false,"added":1743066844931}]},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false},"davis":{"enabled":false,"davisVisualization":{"isAvailable":true}}},"13":{"type":"markdown","content":"### Buckets overview\nBelow you will find all queried buckets listed. \n\nCheck suggestions which buckets to evaluate for the Hybrid Retain with Included Queries model.\n\nRecommendations are calculated based on existing usage: Retain configuration, Scanned Volume, and Bucket size.\n  \nðŸŸ¢ frequently queried - good candidate  \n\nðŸŸ¡ query to retain ratio is low - still worth evaluating, good candidate to provide guardrails to new users  \n\nðŸ”´ too few queries, or the retained data volume is not sufficient to cover the daily query quota\n\nðŸ”µ estimation can be incorrect - still worth checking with more accurate daily retain (details below)"},"14":{"type":"markdown","content":"### Query usage overview for Bucket: $Bucketd | Scanned volumes"},"17":{"type":"markdown","content":" "},"18":{"type":"markdown","content":" "},"19":{"type":"markdown","content":" "},"20":{"title":"Scanned volumes by query type on $Bucketd bucket in last 35d","type":"data","query":"fetch dt.system.query_executions, from:now()-35d\n| filter startsWith(query_string, \"fetch logs\")\n| filter bucket == $Bucketd\n| makeTimeseries included = sum(scanned_bytes.included),\non_demand = sum(scanned_bytes.on_demand)\n,total = sum(scanned_bytes),\ninterval:24h","visualization":"lineChart","visualizationSettings":{"thresholds":[{"id":1,"field":"","title":"","isEnabled":true,"rules":[{"id":0,"color":{"Default":"var(--dt-colors-charts-status-ideal-default, #2f6863)"},"comparator":"â‰¥","label":""},{"id":1,"color":{"Default":"var(--dt-colors-charts-status-warning-default, #eca440)"},"comparator":"â‰¥","label":""},{"id":2,"color":{"Default":"var(--dt-colors-charts-status-critical-default, #c4233b)"},"comparator":"â‰¥","label":""}]}],"chartSettings":{"gapPolicy":"gap","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"curve":"linear","pointsDisplay":"auto","categoricalBarChartSettings":{"layout":"horizontal","categoryAxisTickLayout":"horizontal","scale":"absolute","groupMode":"stacked","colorPaletteMode":"multi-color","valueAxisScale":"linear"},"colorPalette":"categorical","valueRepresentation":"absolute","truncationMode":"middle","bandChartSettings":{"lower":"included","upper":"on_demand"},"xAxisScaling":"analyzedTimeframe","xAxisLabel":"timeframe","xAxisIsLabelVisible":false,"hiddenLegendFields":["interval"],"fieldMapping":{"timestamp":"timeframe","leftAxisValues":["included","on_demand","total"]},"leftYAxisSettings":{},"legend":{"position":"bottom","hidden":false}},"singleValue":{"showLabel":true,"label":"","prefixIcon":"AnalyticsIcon","isIconVisible":false,"autoscale":true,"alignment":"center","colorThresholdTarget":"value"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"linewrapEnabled":false,"lineWrapIds":[],"monospacedFontEnabled":false,"monospacedFontColumns":[],"columnWidths":{},"columnTypeOverrides":[{"fields":["included","on_demand"],"value":"sparkline","id":1743067457081}]},"honeycomb":{"shape":"hexagon","legend":{"hidden":false,"position":"auto","ratio":"auto"},"dataMappings":{},"displayedFields":[],"truncationMode":"middle","colorMode":"color-palette","colorPalette":"categorical"},"histogram":{"legend":{"position":"auto"},"yAxis":{"label":"Frequency","isLabelVisible":true,"scale":"linear"},"colorPalette":"categorical","dataMappings":[],"variant":"single","truncationMode":"middle"},"valueBoundaries":{"min":"auto","max":"auto"},"autoSelectVisualization":true},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false},"davis":{"enabled":false,"davisVisualization":{"isAvailable":true}}},"31":{"type":"markdown","content":"#### Next step: Compare the models\nBelow you will find cost simulation for the two models. **Ingest costs are excluded as they are the same for both models.**\n\nâš ï¸ Information provided is just a simulation and in reality it can be different once enabled.\n\nBe aware that Retention with Included Queries was introduced to make costs more predictable and to provide guardrails for users new to Dynatrace - the intention was not always to be cheaper.\n"},"37":{"title":"Est. monthly cost for on-demand queries","type":"data","query":"// Estimates monthly costs of queries that will be executed beyond the included queries timeperiod\n// Scans all the executed queries\n// Filters out queries below SimulateIncludedQueriesDays time period\n// Sums the total fraction of scanned bytes from timeframes beyond included queries\n// fraction = if scanned_bytes is 100GB and timeframe is 90d and included queries is 10d it will assume ratio = (90 - 10) / 90 and scanned_bytes = 89GB because 11GB was included \nfetch dt.system.query_executions, from:now()-35d\n| filter startsWith(query_string, \"fetch logs\")\n| filter bucket == $Bucketd\n| fieldsAdd \ndiff = unixSecondsFromTimestamp(timestamp) - unixSecondsFromTimestamp(analysis_timeframe.start) \n| fieldsAdd timeframe = toLong(diff / 3600 / 24)\n| filterOut if ($SimulateIncludedQueriesDays == \"0\", false)\n| filterOut if ($SimulateIncludedQueriesDays == \"-1\", false)\n| filterOut if (toLong($SimulateIncludedQueriesDays) > 0, \n  timeframe <= toLong($SimulateIncludedQueriesDays)) \n| fieldsAdd ratio = if (timeframe > toDouble($SimulateIncludedQueriesDays), (toDouble(timeframe) - toDouble($SimulateIncludedQueriesDays)) / toDouble(timeframe), else: 1.0)\n| summarize included = if ($SimulateIncludedQueriesDays == \"-1\", sum(scanned_bytes.on_demand), else: sum(scanned_bytes * ratio))\n| fieldsAdd  cost = included / 1000 / 1000 / 1000 * toDouble($PriceQuery)\n| fieldsAdd cost = if ($SimulateIncludedQueriesDays == \"0\", 0, else: cost) \n| fields cost = (cost / 35)  * 30","visualization":"singleValue","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"gap","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"curve":"linear","pointsDisplay":"auto","categoricalBarChartSettings":{"layout":"horizontal","categoryAxisTickLayout":"horizontal","scale":"absolute","groupMode":"stacked","colorPaletteMode":"multi-color","valueAxisScale":"linear"},"colorPalette":"categorical","valueRepresentation":"absolute","truncationMode":"middle","xAxisScaling":"analyzedTimeframe","xAxisLabel":"timestamp","xAxisIsLabelVisible":false,"hiddenLegendFields":["interval"],"leftYAxisSettings":{}},"singleValue":{"showLabel":false,"label":"query_quota","prefixIcon":"AnalyticsIcon","isIconVisible":false,"autoscale":true,"alignment":"center","colorThresholdTarget":"value","recordField":"cost","trend":{"trendType":"auto","isVisible":true},"sparklineSettings":{}},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"linewrapEnabled":false,"lineWrapIds":[],"monospacedFontEnabled":false,"monospacedFontColumns":[],"columnWidths":{},"columnTypeOverrides":[],"columnOrder":["[\"cost\"]"]},"honeycomb":{"shape":"hexagon","legend":{"hidden":false,"position":"auto","ratio":"auto"},"dataMappings":{},"displayedFields":[],"truncationMode":"middle","colorMode":"color-palette","colorPalette":"categorical"},"histogram":{"legend":{"position":"auto"},"yAxis":{"label":"Frequency","isLabelVisible":true,"scale":"linear"},"colorPalette":"categorical","dataMappings":[],"variant":"single","truncationMode":"middle"},"valueBoundaries":{"min":"auto","max":"auto"},"autoSelectVisualization":false,"unitsOverrides":[{"identifier":"cost","unitCategory":"currency","baseUnit":"usd","displayUnit":null,"decimals":2,"suffix":"","delimiter":false,"added":1743066844931}]},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":-1,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false},"davis":{"enabled":false,"davisVisualization":{"isAvailable":true}}},"38":{"type":"markdown","content":"##### Hybrid-Retain with Included Queries (retention volume-based / RwIQ)\n\nTotal cost includes:\n- Retain with Included Queries - data retained within the included queries\n   - Adjust by changing the amount of days using the SimulateIncludedQueriesDays field\n- Retain - data retained beyond the included queries time period (IRQ model)\n- Queries - data scans beyond the included queries time period defined"},"39":{"type":"markdown","content":" ##### Queries (usage-based / IRQ)\n Total daily cost includes pricing components:\n- Retain - data retained in the bucket\n- Queries - data scanned"},"41":{"title":"Est. monthly cost for IRQ","type":"data","query":"fetch dt.system.buckets\n| filter dt.system.table == \"logs\"\n| filter name == $Bucketd\n| fieldsAdd  cost = estimated_uncompressed_bytes / 1000 / 1000 / 1000 * toDouble($PriceRetain)\n| fields cost\n| append [\nfetch dt.system.query_executions, from:now()-35d\n| filter startsWith(query_string, \"fetch logs\")\n| filter bucket == $Bucketd\n| summarize included = sum(scanned_bytes)\n| fieldsAdd cost = (included / 1000 / 1000 / 1000 * toDouble($PriceQuery)) / 35\n]\n| summarize cost = sum(cost) * 30\n","visualization":"singleValue","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"gap","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"curve":"linear","pointsDisplay":"auto","categoricalBarChartSettings":{"layout":"horizontal","categoryAxisTickLayout":"horizontal","scale":"absolute","groupMode":"stacked","colorPaletteMode":"multi-color","valueAxisScale":"linear"},"colorPalette":"categorical","valueRepresentation":"absolute","truncationMode":"middle"},"singleValue":{"showLabel":false,"label":"sum(billed_bytes)","prefixIcon":"AnalyticsIcon","isIconVisible":false,"autoscale":true,"alignment":"center","colorThresholdTarget":"value","recordField":"cost","trend":{"trendType":"auto","isVisible":true},"sparklineSettings":{}},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"linewrapEnabled":false,"lineWrapIds":[],"monospacedFontEnabled":false,"monospacedFontColumns":[],"columnWidths":{"[\"total\"]":44,"[\"bucket\"]":416.62,"[\"size\"]":163.18333435058594},"columnTypeOverrides":[],"columnOrder":["[\"cost\"]"],"sortBy":{"columnId":"[\"size\"]","direction":"descending"}},"honeycomb":{"shape":"hexagon","legend":{"hidden":false,"position":"auto","ratio":"auto"},"dataMappings":{},"displayedFields":[],"truncationMode":"middle","colorMode":"color-palette","colorPalette":"categorical"},"histogram":{"legend":{"position":"auto"},"yAxis":{"label":"Frequency","isLabelVisible":true,"scale":"linear"},"colorPalette":"categorical","dataMappings":[],"variant":"single","truncationMode":"middle"},"valueBoundaries":{"min":"auto","max":"auto"},"autoSelectVisualization":false,"unitsOverrides":[{"identifier":"cost","unitCategory":"currency","baseUnit":"usd","displayUnit":null,"decimals":2,"suffix":"","delimiter":false,"added":1742988494767}]},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false},"davis":{"enabled":false,"davisVisualization":{"isAvailable":true}}},"42":{"title":"Est. monthly cost for RwIQ","type":"data","query":"fetch dt.system.buckets\n// Retain with Included Queries\n| filter dt.system.table == \"logs\"\n| filter name == $Bucketd\n| fieldsAdd included_query_days = if (toLong($SimulateIncludedQueriesDays) >= 0, toLong($SimulateIncludedQueriesDays), else: included_query_days)\n| fieldsAdd included_retain = if (included_query_days > 0, (estimated_uncompressed_bytes / retention_days) * included_query_days, else: 0) \n| fieldsAdd cost = (included_retain) / 1000 / 1000 / 1000 * toDouble($PriceRwIQ)\n| fieldsAdd cost = if ($SimulateIncludedQueriesDays == \"0\", 0, else: cost) \n| append [\n// Retain \n  fetch dt.system.buckets\n  | filter dt.system.table == \"logs\"\n  | filter name == $Bucketd\n  | fieldsAdd included_query_days = if (toLong($SimulateIncludedQueriesDays) >= 0, toLong($SimulateIncludedQueriesDays), else: included_query_days)\n  | fieldsAdd included_retain = if (included_query_days > 0, (estimated_uncompressed_bytes / retention_days) * included_query_days, else: 0) \n  | fieldsAdd cost = (estimated_uncompressed_bytes -  included_retain) / 1000 / 1000 / 1000 * toDouble($PriceRetain)\n  | fieldsAdd cost = if ($SimulateIncludedQueriesDays == \"0\", 0, else: cost) \n]\n| append [\n  // Query\n  fetch dt.system.query_executions, from:now()-35d\n  | filter startsWith(query_string, \"fetch logs\")\n  | filter bucket == $Bucketd\n  | fieldsAdd \n  diff = unixSecondsFromTimestamp(timestamp) - unixSecondsFromTimestamp(analysis_timeframe.start) \n  | fieldsAdd timeframe = toLong(diff / 3600 / 24)\n  | filterOut if ($SimulateIncludedQueriesDays == \"0\", false)\n  | filterOut if ($SimulateIncludedQueriesDays == \"-1\", false)\n  | filterOut if (toLong($SimulateIncludedQueriesDays) > 0, \n    timeframe <= toLong($SimulateIncludedQueriesDays)) \n  | fieldsAdd ratio = if (timeframe > toDouble($SimulateIncludedQueriesDays), (toDouble(timeframe) - toDouble($SimulateIncludedQueriesDays)) / toDouble(timeframe), else: 1.0)\n  | summarize included = if ($SimulateIncludedQueriesDays == \"-1\", sum(scanned_bytes.on_demand), else: sum(scanned_bytes * ratio))\n  | fieldsAdd  cost = included / 1000 / 1000 / 1000 * toDouble($PriceQuery)\n  | fieldsAdd cost = if ($SimulateIncludedQueriesDays == \"0\", 0, else: cost) \n  | fields cost = (cost / 35)\n]\n| summarize cost = sum(cost) * 30","visualization":"singleValue","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"gap","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"curve":"linear","pointsDisplay":"auto","categoricalBarChartSettings":{"layout":"horizontal","categoryAxisTickLayout":"horizontal","scale":"absolute","groupMode":"stacked","colorPaletteMode":"multi-color","valueAxisScale":"linear"},"colorPalette":"categorical","valueRepresentation":"absolute","truncationMode":"middle"},"singleValue":{"showLabel":false,"label":"sum(billed_bytes)","prefixIcon":"AnalyticsIcon","isIconVisible":false,"autoscale":true,"alignment":"center","colorThresholdTarget":"value","recordField":"cost","trend":{"trendType":"auto","isVisible":true},"sparklineSettings":{}},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"linewrapEnabled":false,"lineWrapIds":[],"monospacedFontEnabled":false,"monospacedFontColumns":[],"columnWidths":{"[\"total\"]":44,"[\"bucket\"]":416.62,"[\"size\"]":163.18333435058594},"columnTypeOverrides":[],"columnOrder":["[\"cost\"]"],"sortBy":{"columnId":"[\"size\"]","direction":"descending"}},"honeycomb":{"shape":"hexagon","legend":{"hidden":false,"position":"auto","ratio":"auto"},"dataMappings":{},"displayedFields":[],"truncationMode":"middle","colorMode":"color-palette","colorPalette":"categorical"},"histogram":{"legend":{"position":"auto"},"yAxis":{"label":"Frequency","isLabelVisible":true,"scale":"linear"},"colorPalette":"categorical","dataMappings":[],"variant":"single","truncationMode":"middle"},"valueBoundaries":{"min":"auto","max":"auto"},"autoSelectVisualization":false,"unitsOverrides":[{"identifier":"cost","unitCategory":"currency","baseUnit":"usd","displayUnit":null,"decimals":2,"suffix":"","delimiter":false,"added":1742988494767}]},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false},"davis":{"enabled":false,"davisVisualization":{"isAvailable":true}}},"44":{"title":"","type":"data","query":"fetch dt.system.buckets\n| filter dt.system.table == \"logs\"\n| filter name == $Bucketd\n| fieldsAdd included_query_days = if (toLong($SimulateIncludedQueriesDays) >= 0, toLong($SimulateIncludedQueriesDays), else: included_query_days)\n| fieldsAdd query_quota = if (included_query_days > 0, (estimated_uncompressed_bytes / retention_days) * included_query_days * 15.0, else: 0) \n| fields query_quota\n| append [\nfetch dt.system.query_executions, from:now()-24h\n| filter startsWith(query_string, \"fetch logs\")\n| filter bucket == $Bucketd\n| fieldsAdd \ndiff = unixSecondsFromTimestamp(timestamp) - unixSecondsFromTimestamp(analysis_timeframe.start) \n| fieldsAdd timeframe = toLong(diff / 3600 / 24)\n| filterOut if ($SimulateIncludedQueriesDays == \"0\", true, else: false)\n| filterOut if ($SimulateIncludedQueriesDays == \"-1\", false)\n| filterOut if (toLong($SimulateIncludedQueriesDays) > 0, \n  timeframe > toLong($SimulateIncludedQueriesDays)) \n| summarize included = if ($SimulateIncludedQueriesDays == \"-1\", sum(scanned_bytes.included), else: sum(scanned_bytes))\n]\n| summarize quota = max(query_quota), included = max(included)\n| fields isBelowQuota = if (included <= quota, \"âœ… Query quota is enough\", else: \"âš ï¸ Query quota exceeded. Adjust the Include Queries Days variable\") \n","visualization":"singleValue","visualizationSettings":{"thresholds":[{"id":1,"field":"isBelowQuota","title":"isBelowQuota","isEnabled":true,"rules":[{"id":0,"color":{"Default":"var(--dt-colors-charts-status-ideal-default, #2f6863)"},"comparator":"=","label":"","value":"âœ… Query quota is enough"},{"id":2,"color":{"Default":"var(--dt-colors-charts-status-critical-default, #c4233b)"},"comparator":"=","label":"","value":"âš ï¸ Query quota exceeded. Adjust the Include Queries Days variable"}]}],"chartSettings":{"gapPolicy":"gap","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"curve":"linear","pointsDisplay":"auto","categoricalBarChartSettings":{"layout":"horizontal","categoryAxisTickLayout":"horizontal","scale":"absolute","groupMode":"stacked","colorPaletteMode":"multi-color","valueAxisScale":"linear"},"colorPalette":"categorical","valueRepresentation":"absolute","truncationMode":"middle","xAxisScaling":"analyzedTimeframe","xAxisLabel":"timeframe","xAxisIsLabelVisible":false,"hiddenLegendFields":["interval"],"leftYAxisSettings":{}},"singleValue":{"showLabel":false,"label":"query_quota","prefixIcon":"AnalyticsIcon","isIconVisible":false,"autoscale":true,"alignment":"center","colorThresholdTarget":"value","recordField":"isBelowQuota","trend":{"trendType":"auto","isVisible":true},"sparklineSettings":{}},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"linewrapEnabled":false,"lineWrapIds":[],"monospacedFontEnabled":false,"monospacedFontColumns":[],"columnWidths":{},"columnTypeOverrides":[],"columnOrder":["[\"isBelowQuota\"]"]},"honeycomb":{"shape":"hexagon","legend":{"hidden":false,"position":"auto","ratio":"auto"},"dataMappings":{},"displayedFields":[],"truncationMode":"middle","colorMode":"color-palette","colorPalette":"categorical"},"histogram":{"legend":{"position":"auto"},"yAxis":{"label":"Frequency","isLabelVisible":true,"scale":"linear"},"colorPalette":"categorical","dataMappings":[],"variant":"single","truncationMode":"middle"},"valueBoundaries":{"min":"auto","max":"auto"},"autoSelectVisualization":false,"unitsOverrides":[{"identifier":"query_quota","unitCategory":"data","baseUnit":"byte","displayUnit":null,"decimals":2,"suffix":"","delimiter":false,"added":1743066844931}]},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false},"davis":{"enabled":false,"davisVisualization":{"isAvailable":true}}},"45":{"type":"markdown","content":"# "},"46":{"type":"markdown","content":"##### Possible cost optimization\nIf the number below is high it means that queries scan beyond simulated included queries period. You can still reduce your bill by:\n- Allowing users to run only included queries using permissions\n- Changing the Simulate Included Queries Days value at the top. Only 10 - 35 are vaild.\n"},"47":{"type":"markdown","content":"## âš ï¸ Estimations can be wrong \n\nCost simulation is an estimation based on current usage. Total cost can be different because your ingest and query patterns can change.\n\nEstimations are assuming that your log retain and query patterns are stable. \n\n##### ðŸ”µ To get more accurate estimations based on recent retain volumes, edit the tile below and follow instructions"},"48":{"title":"Estimated cost can different by: ","type":"data","query":"// Instructions:\n// 1. Take the Scanned bytes value (below Run button)\n// 2. Add it's value in ValueFromScannedGBytes. Convert units to GB!\n// 3. Hit Run button\n// 4. Look at the % difference\ndata record(est_daily_ingest_recent=0, right.est_daily_ingest_gb = 0, bucket=$Bucketd)\n| append [ fetch logs, from: now()-1d, samplingRatio: 10000, scanLimitGBytes: -1 | filter dt.system.bucket == $Bucketd | fieldsAdd bucket = $Bucketd | summarize size = count(), by: {bucket} ]\n| summarize size = sum(size), by: {bucket}\n// --- DO NOT MODIFY ABOVE\n\n// // Add the Scanned bytes value in GB\n// // If you see 100MB use 100 MB / 1000.0 = 0.98\n// // If you see 2TB use 2 TB * 1000.0 = 2048 GB\n| fieldsAdd ValueFromScannedGBytes = null\n\n// --- DO NOT MODIFY BELOW\n| fieldsAdd est_daily_ingest_recent = ValueFromScannedGBytes * 10000.0\n| fieldsAdd cost_ingest = est_daily_ingest_recent * toLong($SimulateIncludedQueriesDays) * toDouble($PriceRwIQ)\n| append [\n  // Retain with Included Queries\n  fetch dt.system.buckets\n  | filter dt.system.table == \"logs\"\n  | filter name == $Bucketd\n  | fieldsAdd included_query_days = if (toLong($SimulateIncludedQueriesDays) >= 0, toLong($SimulateIncludedQueriesDays), else: included_query_days)\n  | fieldsAdd included_retain = if (included_query_days > 0, (estimated_uncompressed_bytes / retention_days) * included_query_days, else: 0) \n  | fieldsAdd cost_bucket = (included_retain) / 1000 / 1000 / 1000 * toDouble($PriceRwIQ)\n  | fieldsAdd cost_bucket = if ($SimulateIncludedQueriesDays == \"0\", 0, else: cost_bucket) \n]\n| summarize est_daily_ingest_by_bucket = max(cost_bucket), est_daily_ingest_by_query = max(cost_ingest)\n| fieldsAdd ratio = est_daily_ingest_by_query / est_daily_ingest_by_bucket - 1\n| fieldsAdd ratio = 100.0 * ratio","visualization":"singleValue","visualizationSettings":{"thresholds":[{"id":1,"field":"msg","title":"","isEnabled":true,"rules":[{"id":0,"color":{"Default":"var(--dt-colors-charts-categorical-color-04-default, #d85a9f)"},"comparator":"=","label":"","value":"Change the tile to validate estimation"},{"id":1,"color":{"Default":"var(--dt-colors-charts-status-warning-default, #eca440)"},"comparator":"=","label":""},{"id":2,"color":{"Default":"var(--dt-colors-charts-status-critical-default, #c4233b)"},"comparator":"=","label":""}]}],"chartSettings":{"gapPolicy":"gap","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"curve":"linear","pointsDisplay":"auto","categoricalBarChartSettings":{"layout":"horizontal","categoryAxisTickLayout":"horizontal","scale":"absolute","groupMode":"stacked","colorPaletteMode":"multi-color","valueAxisScale":"linear","categoryAxisLabel":"est_daily_ingest_by_bucket,est_daily_ingest_by_query,ratio","valueAxisLabel":"est_daily_ingest_by_bucket,est_daily_ingest_by_query,ratio","tooltipVariant":"single"},"colorPalette":"categorical","valueRepresentation":"absolute","truncationMode":"middle"},"singleValue":{"showLabel":false,"label":"msg","prefixIcon":"WarningIcon","isIconVisible":false,"recordField":"ratio","autoscale":true,"sparklineSettings":{},"alignment":"center","trend":{"trendType":"auto","isVisible":true},"colorThresholdTarget":"background"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"linewrapEnabled":true,"lineWrapIds":[],"monospacedFontEnabled":false,"monospacedFontColumns":[],"columnWidths":{},"columnTypeOverrides":[],"columnOrder":["[\"est_daily_ingest_by_bucket\"]","[\"est_daily_ingest_by_query\"]","[\"ratio\"]"]},"honeycomb":{"shape":"hexagon","legend":{"hidden":false,"position":"auto","ratio":"auto"},"dataMappings":{},"displayedFields":[],"truncationMode":"middle","colorMode":"color-palette","colorPalette":"categorical"},"histogram":{"legend":{"position":"auto"},"yAxis":{"label":"Frequency","isLabelVisible":true,"scale":"linear"},"colorPalette":"categorical","dataMappings":[],"variant":"single","truncationMode":"middle"},"valueBoundaries":{"min":"auto","max":"auto"},"autoSelectVisualization":false,"dataMapping":{"latitude":"est_daily_ingest_by_query","longitude":"est_daily_ingest_by_bucket","displayedFields":["ratio"]},"legend":{"textTruncationMode":"middle","showLegend":true,"position":"auto"},"tooltip":{"showCustomFields":false},"unitsOverrides":[{"identifier":"ratio","unitCategory":"percentage","baseUnit":"percent","displayUnit":null,"decimals":0,"suffix":"","delimiter":false,"added":1747062471205}]},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false},"davis":{"enabled":false,"davisVisualization":{"isAvailable":true}}},"49":{"type":"markdown","content":"# "},"50":{"type":"markdown","content":"##### How to change bucket settings? #####\nIf you're happy with the simulation, go to **Storage management** app and edit bucket settings.\n\nAlso, consider adding additional IAM policies to users or groups to define a scope of users who can query only the defined included time periods to avoid additional costs.  \n"}},"layouts":{"0":{"x":0,"y":0,"w":24,"h":2},"3":{"x":0,"y":7,"w":24,"h":6},"9":{"x":17,"y":49,"w":7,"h":8},"10":{"x":0,"y":47,"w":24,"h":2},"12":{"x":0,"y":26,"w":4,"h":3},"13":{"x":0,"y":2,"w":24,"h":5},"14":{"x":0,"y":46,"w":24,"h":1},"17":{"x":0,"y":45,"w":24,"h":1},"18":{"x":0,"y":59,"w":24,"h":1},"19":{"x":0,"y":57,"w":24,"h":2},"20":{"x":0,"y":49,"w":17,"h":8},"31":{"x":0,"y":13,"w":24,"h":5},"37":{"x":0,"y":32,"w":12,"h":2},"38":{"x":0,"y":18,"w":12,"h":4},"39":{"x":15,"y":18,"w":9,"h":4},"41":{"x":15,"y":22,"w":9,"h":4},"42":{"x":0,"y":22,"w":12,"h":4},"44":{"x":4,"y":26,"w":8,"h":3},"45":{"x":12,"y":18,"w":3,"h":16},"46":{"x":0,"y":29,"w":12,"h":3},"47":{"x":0,"y":37,"w":16,"h":5},"48":{"x":0,"y":42,"w":16,"h":3},"49":{"x":15,"y":26,"w":9,"h":7},"50":{"x":0,"y":34,"w":24,"h":3}},"importedWithCode":false,"settings":{}}